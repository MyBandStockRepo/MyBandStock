- current_user = (session[:user_id]) ? User.find(session[:user_id]) : nil
- user_found = false

%table.top_ten_shareholders
  %th.orange_bar.top_ten_title{ :colspan => 3 }
    .top_ten_icon 
    TOP TEN SHAREHOLDERS
  -if top_ten
    -top_ten.each_with_index do |man, i|
      -if current_user && man.email == current_user.email
        - user_found = true
        - class_name = 'highlight'
      -else
        - class_name = ''
      -# Odd/even classname with "highlight" class if the row is of the current user.
      %tr{ :class => "#{ (i % 2 == 1) ? 'odd' : 'even' } #{ class_name }" }
        %td.list_number
          = (i+1).to_s + '.'
        %td.shareholder_name
          = raw html_obfuscate(man.email)
        %td.share_amount
          = man.net
    -if !user_found && current_user
      %tr.highlight.even
        %td.list_number
          = user_rank.to_s + '.'
        %td.shareholder_name
          = raw html_obfuscate(current_user.email)
        %td.share_amount
          - share_total_row = current_user.share_totals.where(:band_id => band.id).first
          = (share_total_row) ? share_total_row.net : 0
  -else
    %tr
      %td
        .top_ten_notice
          This band has no shareholders.
          %br
          = link_to 'You can be the first!', fan_new_suggestions_path(band.name)
