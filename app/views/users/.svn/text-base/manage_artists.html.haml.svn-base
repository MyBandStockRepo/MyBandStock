#content-utility.control-panel
  #utility-overview
    =render :partial => 'users/stat_box_primary', :locals => {:user => @user}
    #overview-secondary
      =link_to image_tag(@user.path_to_headline_image(:center_graphic)), :controller => 'users', :action => 'edit', :id => @user.id, :anchor => 'photo'
  #utility-player
    =render :partial => 'common_partials/audio_player', :locals => {:playlist_url => @random_band.playlist_url}
    =render :partial => 'common_partials/user_player_playlist', :locals => {:playlist_songs => @random_band.playlist_songs}
  =render :partial => "control_panel_tabs"
#content-primary.artists
  
  .content-section
    .section-primary
      -if @user.invested_artists.empty?
        %h2.invested You have not made investments in any artists
      -else
        %h2.invested Invested Artists:
        -for invested_artist in @user.invested_artists  
          %h3<
            =invested_artist.name
          .artist
            .artist-stock
              .artist-details
                .artist-image
                  =image_tag(invested_artist.path_to_headline_photo(:artist_insert))
                %dl
                  %dt Net Worth:
                  %dd.worth<
                    ="$#{invested_artist.net_worth}"
                  %dt Total Fans:
                  %dd<
                    =invested_artist.total_fans
                  %dt Location:
                  %dd<
                    ="#{invested_artist.city}, #{invested_artist.country.name}"
                  %dt Join Date:
                  %dd<
                    =invested_artist.created_at.strftime("%b %d, %y")
                %p
                  =link_to "Perks (#{invested_artist.perks.size})", :controller => 'bands', :action => 'show', :band_short_name => invested_artist.short_name
                %p
                  =link_to "Concerts (#{invested_artist.concerts_after_now.size})", :controller => 'bands', :action => 'show', :band_short_name => invested_artist.short_name    
              .user-details
                .ranking
                  %dl.ranks
                    %dt.first My Rank: 
                    %dd TBD
                    %dt.last Artist Rank:
                    %dd TBD
                  %h4 
                    My Shares:
                  %dl.shares
                    %dt Total Shares:
                    %dd<
                      =@user.contributions_made_to_band(invested_artist.id).collect{|c| c.contribution_level.number_of_shares}.sum
                    %dt Shares from Concerts:
                    %dd Coming Soon!
                .perks
                  %h4 My Perks:
                  -for earned_perk in @user.earned_perks_from_band(invested_artist)
                    %ul{:id => "earned-perk-#{earned_perk.id}" }
                      %li.perk<
                        =earned_perk.perk.name
                      -if earned_perk.google_checkout_order.contributions.first.project.complete
                        %li.unfullfilled
                          -if earned_perk.filled
                            =image_tag ("backgrounds/icons/icon-happyface.gif", :alt => "Filled", :width => "12", :height => "12")
                          -else
                            =image_tag ("backgrounds/icons/icon-sadface-grey.gif", :alt => "Unfilled", :width => "12", :height => "12")
                            -url_hash = {:controller => 'earned_perks', :action => 'toggle_perk_confirmed', :id => earned_perk.id}
                            %span{:id => "earned_perk_#{earned_perk.id}_confirmed_status"}
                              -unless earned_perk.confirmed
                                =link_to_remote 'confirm', {:url => url_hash}, :href => url_for(url_hash), :class => "utility-link"
                              -else
                                =link_to_remote 'unconfirm', {:url => url_hash}, :href => url_for(url_hash), :class => "utility-link"
                            %span#help-link
                              -url_hash = {:controller => 'help_articles', :action => 'by_name', :article_name => 'perks_confirmed_status_explanation'} 
                          =link_to_remote image_tag('backgrounds/icons/icon-14x14-question.png'), {:url => url_hash}, :href => url_for(url_hash), :class => "help"
                        %li.flagged{:id => "earned-perk-#{earned_perk.id}-flagged-link"}
                          -if earned_perk.flagged
            
                            -url_hash = {:controller => 'earned_perks', :action => 'unflag_perk', :id => earned_perk.id}
                            =link_to_remote image_tag("backgrounds/icons/icon-unflag.gif", :alt => "unflag"), {:url => url_hash}, :href => url_for(url_hash)
                          -else
                            -url_hash = {:controller => 'earned_perks', :action => 'flag_perk', :id => earned_perk.id}
                            =link_to_remote image_tag("backgrounds/icons/icon-flag.gif", :alt => "flag"), {:url => url_hash}, :href => url_for(url_hash)
                          %span#help-link
                            -url_hash = {:controller => 'help_articles', :action => 'by_name', :article_name => 'perk_flagged_explanation'} 
                            =link_to_remote image_tag('backgrounds/icons/icon-14x14-question.png'), {:url => url_hash}, :href => url_for(url_hash), :class => "help"
                      -else
                        %li.not-finished
                          Project not complete yet.
                          -url_hash = {:controller => 'help_articles', :action => 'by_name', :article_name => 'perks_ship_date_explanation'} 
                          =link_to_remote "(Where is my perk?#{image_tag('backgrounds/icons/icon-14x14-question.png')})", {:url => url_hash}, :href => url_for(url_hash), :class => "help"
              
    .section-sidebar
      -if @prospective_artists.empty?
        %h2 You are not watching any artists
      -else
        %h2 Prospective artists:
        -for artist in @prospective_artists      
          .prospect{:id => "prospective-artist-#{artist.id}"}
            %h3<
              =artist.name
            -url_hash = {:controller => 'users', :action => 'toggle_band_watching', :id => artist.id, :remove_div => true}
            =link_to_remote 'remove',{:url => url_hash}, :href => url_for(url_hash), :class => 'utility-link'
            .details
              =image_tag(artist.path_to_headline_photo(:artist_insert))
              %dl 
                %dt Artist Rank:
                %dd.rank<
                  TBD
                %dt Net Worth:
                %dd.worth<
                  ="$#{artist.net_worth}"
                %dt Total Fans:
                %dd<
                  =artist.total_fans
                %dt New Fans last Week
                %dd<
                  =artist.new_fans_last_week
              %p
                =link_to "New Perks (#{artist.perks.count})", :controller => 'bands', :action => 'show', :band_short_name => artist.short_name
              %p
                =link_to "New Concerts (#{artist.concerts_after_now.size})", :controller => 'bands', :action => 'show', :band_short_name => artist.short_name
              %p
                =link_to 'News', :controller => 'news_entries', :action => 'by_band', :band_short_name => artist.short_name
